<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>給最愛的你</title>
    <!-- 建議：將圖示上傳到 Imgur 或 GitHub 專案資料夾中，然後使用直接連結 -->
    <link rel="apple-touch-icon" href="image/icon.png">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.7.77/Tone.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <style>
        body {
    font-family: 'Noto Sans TC', sans-serif;
    background-color: #0d1b2a; /* 深邃星空藍 */
    color: #e0e1dd;
}
#landing-page, #surprise-container {
    display: none; /* Initially hidden */
}
#password-gate {
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    height: 100vh;
    background-color: #0d1b2a;
    transition: opacity 0.5s ease-out;
}
.day-card {
    background-color: #1b263b; /* 較淺的藍灰色 */
    border-radius: 8px;
    transition: all 0.3s ease;
    box-shadow: 0 4px 15px rgba(0,0,0,0.2);
}
.day-card.unlocked:hover {
    transform: translateY(-5px) scale(1.05);
    background-color: #e0b1cb; /* 柔和的粉金色 */
    color: #0d1b2a;
    cursor: pointer;
}
.day-card.locked {
    background-color: #415a77; /* 更淺的藍灰色 */
    cursor: not-allowed;
}
.modal { display: none; position: fixed; z-index: 100; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.7); }
.modal-content { background-color: #1b263b; margin: 5% auto; padding: 2rem; border: 1px solid #778da9; width: 90%; max-width: 800px; border-radius: 10px; position: relative; }
.modal .close-button { color: #aaa; position: absolute; top: 1rem; right: 1.5rem; font-size: 28px; font-weight: bold; cursor: pointer; }
.modal .close-button:hover, .modal .close-button:focus { color: white; }

#birthday-title, #personal-message, #monday-title, #monday-content {
    transition: opacity 1.5s ease-in-out;
}
#fireworks-canvas {
    position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 51;
}
#birthday-title, #personal-message, #monday-title, #monday-content-wrapper {
    position: absolute;
    z-index: 52;
    text-align: center;
    pointer-events: none;
}
.accent-color { color: #e0e1dd; } /* 月光銀/星塵白 */
.accent-bg { background-color: #415a77; } /* 藍灰色 */
.hover-accent-bg:hover { background-color: #778da9; }

/* Game Styles */
#spot-the-diff-container { position: relative; display: inline-block; }
.diff-circle { position: absolute; /* border: 2px solid red; */ border-radius: 50%; cursor: pointer; box-sizing: border-box; }
.diff-circle.found { background-color: rgba(0, 255, 0, 0.4); border: 2px solid limegreen; }

/* Gift Reveal Styles */
#gift-reveal-container {
    display: none;
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    background-color: rgba(0, 0, 0, 0.85);
    z-index: 200;
    flex-direction: column;
    justify-content: center;
    align-items: center;
}
#gift-box {
    cursor: pointer;
    transition: transform 0.3s ease;
}
#gift-box:hover {
    transform: scale(1.1);
}
#gift-box.open {
    animation: glow 1.5s ease-in-out forwards;
}
@keyframes glow {
    0% { transform: scale(1.1); filter: drop-shadow(0 0 5px #fff); }
    50% { transform: scale(1.2); filter: drop-shadow(0 0 25px #fff) drop-shadow(0 0 50px #e0b1cb); }
    100% { transform: scale(1.1); filter: drop-shadow(0 0 5px #fff); opacity: 0; }
}
#gift-result {
    opacity: 0;
    transition: opacity 1s ease-in 1s;
}
#gift-result.visible {
    opacity: 1;
}
    </style>
</head>
<body>
    
    <!-- Password Gate -->
    <div id="password-gate">
        <div class="w-full max-w-xs p-8 bg-gray-800 rounded-lg shadow-lg">
            <h2 class="text-2xl font-bold text-center accent-color mb-6">請輸入密碼</h2>
            <input type="password" id="password-input" class="w-full p-3 bg-gray-700 rounded text-white text-center text-lg tracking-widest">
            <button id="password-submit" class="w-full accent-bg hover-accent-bg text-white font-bold py-3 px-4 rounded mt-4">進入</button>
            <p id="password-error" class="text-red-400 text-center mt-4 h-4"></p>
        </div>
    </div>


    <!-- Landing Page -->
    <div id="landing-page">
        <h1 class="text-4xl md:text-7xl font-bold text-white mb-6 text-center animate-pulse">給我的最愛</h1>
        <p class="text-xl md:text-2xl text-gray-300 mb-12 text-center">九月的每一天，都為你準備了一個小秘密</p>
        <button id="start-button" class="accent-bg hover-accent-bg text-white font-bold py-4 px-8 rounded-full text-xl transition duration-300 transform hover:scale-110">
            接收今天的小驚喜 <i class="fas fa-gift ml-2"></i>
        </button>
    </div>

    <!-- Surprises Calendar -->
    <div id="surprise-container" class="hidden p-4 md:p-8">
        <h2 class="text-3xl md:text-5xl font-bold accent-color mb-8 text-center">九月驚喜日曆</h2>
        <div id="calendar-grid" class="grid grid-cols-3 sm:grid-cols-4 md:grid-cols-5 lg:grid-cols-6 gap-4 max-w-6xl mx-auto"></div>
    </div>

    <!-- Modal for Daily Surprise -->
    <div id="surprise-modal" class="modal">
        <div class="modal-content">
            <span class="close-button">&times;</span>
            <div id="modal-body"></div>
        </div>
    </div>

    <!-- Fireworks container -->
    <div id="fireworks-container" class="hidden fixed top-0 left:0 w-full h-full bg-black z-50 flex justify-center items-center cursor-pointer">
        <canvas id="fireworks-canvas"></canvas>
        <div id="birthday-title" class="px-4">
            <h1 class="text-white text-4xl md:text-6xl font-bold" style="text-shadow: 0 0 20px #e0e1dd;">生日快樂！</h1>
        </div>
        <div id="personal-message" class="px-4 opacity-0">
            <h2 class="text-3xl md:text-4xl font-bold mb-4 accent-color">給全世界最棒的你：</h2>
            <p class="text-gray-300 text-lg md:text-xl max-w-2xl mx-auto">
                謝謝你出現在我的生命裡，像一道光，點亮了我所有的日子。
                願你永遠都能像今天一樣，被愛與快樂包圍。
                未來的每一天，都想和你一起過。
            </p>
        </div>
    </div>
    
    <!-- Monday Motivation Container -->
    <div id="monday-motivation-container" class="hidden fixed top-0 left:0 w-full h-full bg-black z-50 flex justify-center items-center cursor-pointer">
        <span class="close-button absolute top-8 right-8 text-2xl">&times;</span>
        <div id="monday-title" class="px-4">
            <h1 class="text-white text-4xl md:text-6xl font-bold" style="text-shadow: 0 0 20px #a0c4ff;"></h1>
        </div>
        <div id="monday-content-wrapper" class="px-4 opacity-0 w-full max-w-3xl">
            <!-- Monday content will be injected here -->
        </div>
    </div>
    
    <!-- Gift Reveal Container -->
    <div id="gift-reveal-container">
         <span class="close-button absolute top-8 right-8 text-2xl">&times;</span>
         <div id="gift-box">
             <i class="fas fa-gift text-9xl text-pink-300"></i>
             <p class="text-center mt-4 text-lg animate-pulse">點我打開</p>
         </div>
         <div id="gift-result" class="text-center">
            <!-- Gift result will be injected here -->
         </div>
    </div>


    <script>
        // --- 密碼設定 ---
        // 請在這裡修改成你想設定的密碼
        const PASSWORD = 'chen0927';
        // --- 設定結束 ---

        // --- 開發設定 ---
        // 將此設定為 true 可以解鎖所有日期，方便測試與修改。
        // 正式發佈給對方前，請務必改回 false！
        const UNLOCK_ALL_DATES = true;
        // --- 設定結束 ---

        const surprises = {
            1: { 
                title: "第一份禮物",
                type: 'gift',
                content: `
                    <h3 class="text-2xl font-bold accent-color mb-4">恭喜你獲得：</h3>
                    <p class="text-4xl font-bold my-4">Fujifilm X-M5</p>
                    <p>希望你喜歡這份禮物，用它來記錄我們未來更多的美好瞬間！</p>
                `
            },
            2: {
                title: "地點大考驗",
                content: `
                    <h3 class="text-2xl font-bold accent-color mb-4">猜猜這是哪裡？</h3>
                    <img id="blurred-image" src="image/IMG_7615.jpeg" alt="模糊的照片" class="w-full rounded-lg mb-4 cursor-pointer" style="filter: blur(8px);">
                    <p class="text-center">（點擊圖片揭曉答案）</p>
                `,
                gameInit: () => {
                    const img = document.getElementById('blurred-image');
                    img.addEventListener('click', () => {
                        img.style.filter = 'blur(0)';
                    }, { once: true });
                }
            },
            // ... (其他日期的內容保持不變) ...
        };

        document.addEventListener('DOMContentLoaded', function() {
            const startButton = document.getElementById('start-button');
            const landingPage = document.getElementById('landing-page');
            const surpriseContainer = document.getElementById('surprise-container');
            const calendarGrid = document.getElementById('calendar-grid');
            const modal = document.getElementById('surprise-modal');
            const modalBody = document.getElementById('modal-body');
            const modalCloseButton = document.querySelector('.modal .close-button');
            const fireworksContainer = document.getElementById('fireworks-container');
            const birthdayTitle = document.getElementById('birthday-title');
            const personalMessage = document.getElementById('personal-message');
            const canvas = document.getElementById('fireworks-canvas');
            const mondayContainer = document.getElementById('monday-motivation-container');
            const mondayTitle = document.querySelector('#monday-title h1');
            const mondayContentWrapper = document.getElementById('monday-content-wrapper');
            const mondayCloseButton = document.querySelector('#monday-motivation-container .close-button');
            const passwordGate = document.getElementById('password-gate');
            const passwordInput = document.getElementById('password-input');
            const passwordSubmit = document.getElementById('password-submit');
            const passwordError = document.getElementById('password-error');
            const giftContainer = document.getElementById('gift-reveal-container');
            const giftBox = document.getElementById('gift-box');
            const giftResult = document.getElementById('gift-result');
            const giftCloseButton = document.querySelector('#gift-reveal-container .close-button');
            
            // --- 開發設定 ---
            // 將此設定為 true 可以解鎖所有日期，方便測試與修改。
            // 正式發佈給對方前，請務必改回 false！
            const UNLOCK_ALL_DATES = true;
            // --- 設定結束 ---

            const today = new Date();
            const currentMonth = today.getMonth();
            const currentDay = today.getDate();
            
            // --- Password Logic ---
            const checkPassword = () => {
                const input = passwordInput.value.trim();
                if (input === PASSWORD) {
                    passwordGate.style.opacity = 0;
                    setTimeout(() => {
                        passwordGate.style.display = 'none';
                        landingPage.style.display = 'flex';
                    }, 500);
                } else {
                    passwordError.textContent = '密碼錯誤';
                    passwordInput.value = '';
                }
            };

            passwordSubmit.addEventListener('click', checkPassword);
            passwordInput.addEventListener('keyup', (event) => {
                if (event.key === 'Enter') {
                    checkPassword();
                }
            });


            startButton.addEventListener('click', () => {
                landingPage.style.display = 'none';
                surpriseContainer.style.display = 'block';
            });

            const closeModal = () => {
                modal.style.display = 'none';
                mondayContainer.style.display = 'none';
                giftContainer.style.display = 'none';
            };

            modalCloseButton.addEventListener('click', closeModal);
            mondayCloseButton.addEventListener('click', closeModal);
            giftCloseButton.addEventListener('click', closeModal);

            window.addEventListener('click', (event) => {
                if (event.target == modal || event.target == mondayContainer || event.target == giftContainer) {
                    closeModal();
                }
            });
            fireworksContainer.addEventListener('click', () => {
                fireworksContainer.classList.add('hidden');
                if (animationFrameId) {
                    window.cancelAnimationFrame(animationFrameId);
                    animationFrameId = null;
                }
            });

            // 產生日期卡片
            for (let day = 1; day <= 30; day++) {
                const card = document.createElement('div');
                card.className = 'day-card flex flex-col items-center justify-center p-4 aspect-square';
                card.dataset.day = day;
                if(day === 27) card.classList.add('accent-bg', 'text-white', 'animate-pulse');

                const dayText = document.createElement('span');
                dayText.className = 'text-3xl font-bold';
                dayText.textContent = day;
                
                const monthText = document.createElement('span');
                monthText.className = 'text-sm';
                monthText.textContent = '九月';

                card.appendChild(dayText);
                card.appendChild(monthText);

                // 判斷是否解鎖
                if (UNLOCK_ALL_DATES || (currentMonth === 8 && day <= currentDay)) { // 8 代表 9 月 (月份從 0 開始)
                    card.classList.add('unlocked');
                    card.addEventListener('click', () => openSurprise(day));
                } else {
                    card.classList.add('locked');
                    const lockIcon = document.createElement('i');
                    lockIcon.className = 'fas fa-lock absolute text-lg';
                    card.appendChild(lockIcon);
                    dayText.classList.add('opacity-30');
                    monthText.classList.add('opacity-30');
                }
                calendarGrid.appendChild(card);
            }

            function openSurprise(day) {
                const surprise = surprises[day];
                if (!surprise) {
                    modalBody.innerHTML = `<h2 class="text-3xl font-bold text-white mb-6">敬請期待！</h2><p>今天的驚喜還在包裝中...</p>`;
                    modal.style.display = 'block';
                    return;
                }

                if (surprise.type === 'fireworks') {
                    launchFireworks();
                } else if (surprise.type === 'monday') {
                    showMondayMotivation(surprise);
                } else if (surprise.type === 'gift') {
                    showGiftReveal(surprise);
                }
                else {
                    modalBody.innerHTML = `<h2 class="text-3xl font-bold text-white mb-6 border-b-2" style="border-color: #778da9;">${surprise.title}</h2><div>${surprise.content}</div>`;
                    modal.style.display = 'block';
                    if (surprise.gameInit) {
                        // 延遲一點執行，確保 DOM 已經渲染
                        setTimeout(surprise.gameInit, 100);
                    }
                }
            }
            
            function showGiftReveal(surprise) {
                giftResult.innerHTML = surprise.content;
                giftResult.classList.remove('visible');
                giftBox.classList.remove('open');
                giftBox.style.display = 'block';
                giftContainer.style.display = 'flex';

                const openGiftHandler = () => {
                    giftBox.classList.add('open');
                    setTimeout(() => {
                        giftBox.style.display = 'none';
                        giftResult.classList.add('visible');
                    }, 1400);
                };
                giftBox.addEventListener('click', openGiftHandler, { once: true });
            }


            function showMondayMotivation(surprise) {
                mondayTitle.textContent = surprise.openingTitle || '週一加油！';
                mondayContentWrapper.innerHTML = `<div class="p-4 rounded-lg">${surprise.content}</div>`;
                
                // Reset states
                document.getElementById('monday-title').style.opacity = 1;
                mondayContentWrapper.style.opacity = 0;
                mondayContainer.style.display = 'flex';

                setTimeout(() => {
                    document.getElementById('monday-title').style.opacity = 0;
                    setTimeout(() => {
                        mondayContentWrapper.style.opacity = 1;
                        if (surprise.gameInit) {
                           surprise.gameInit();
                        }
                    }, 1500);
                }, 3000);
            }

            // --- 煙火特效邏輯 ---
            const ctx = canvas.getContext('2d');
            let fireworks = [];
            let particles = [];
            let animationFrameId = null;
            
            // Tone.js 音效 (可選)
            let synth, noiseSynth;
            const setupAudio = () => {
                if (typeof Tone !== 'undefined' && !synth) {
                    synth = new Tone.MembraneSynth().toDestination();
                    noiseSynth = new Tone.NoiseSynth({ envelope: { attack: 0.005, decay: 0.2, sustain: 0 } }).toDestination();
                }
            };
            const playLaunchSound = () => noiseSynth?.triggerAttackRelease("4n");
            const playExplodeSound = () => synth?.triggerAttackRelease("C2", "2n");

            function launchFireworks() {
                if (animationFrameId) {
                    cancelAnimationFrame(animationFrameId);
                }
                
                if (typeof Tone !== 'undefined') {
                    Tone.start().then(setupAudio);
                }

                fireworks = [];
                particles = [];
                canvas.width = window.innerWidth;
                canvas.height = window.innerHeight;
                
                birthdayTitle.style.opacity = 1;
                personalMessage.style.opacity = 0;
                fireworksContainer.classList.remove('hidden');

                fireworks.push(new Firework(true)); 

                setTimeout(() => {
                    for(let i = 0; i < 10; i++) { 
                        setTimeout(() => {
                            const randomX = Math.random() * canvas.width;
                            const randomY = Math.random() * (canvas.height / 2);
                            createExplosion(randomX, randomY, 120, false);
                        }, i * 250);
                    }
                }, 1000);

                setTimeout(() => {
                    birthdayTitle.style.opacity = 0;
                    setTimeout(() => personalMessage.style.opacity = 1, 1500);
                }, 3500);

                loop();
            }

            function loop() {
                ctx.globalCompositeOperation = 'destination-out';
                ctx.fillStyle = 'rgba(0, 0, 0, 0.5)';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                ctx.globalCompositeOperation = 'lighter';

                for (let i = fireworks.length - 1; i >= 0; i--) {
                    fireworks[i].draw();
                    if (fireworks[i].update()) {
                        fireworks.splice(i, 1);
                    }
                }
                for (let i = particles.length - 1; i >= 0; i--) {
                    particles[i].draw();
                    if (particles[i].update()) {
                        particles.splice(i, 1);
                    }
                }
                animationFrameId = requestAnimationFrame(loop);
            }

            function createExplosion(x, y, count, isGrand) {
                const hue = Math.random() * 360;
                for (let i = 0; i < count; i++) {
                    particles.push(new Particle(x, y, hue, isGrand));
                }
                playExplodeSound();
            }

            class Particle {
                constructor(x, y, hue, isGrand) {
                    this.x = x;
                    this.y = y;
                    this.hue = hue;
                    this.angle = Math.random() * Math.PI * 2;
                    this.speed = Math.random() * (isGrand ? 18 : 10) + 2;
                    this.friction = 0.96;
                    this.gravity = 1;
                    this.alpha = 1;
                    this.decay = Math.random() * 0.03 + 0.01;
                    this.velX = Math.cos(this.angle) * this.speed;
                    this.velY = Math.sin(this.angle) * this.speed;
                }
                update() {
                    this.velX *= this.friction;
                    this.velY *= this.friction;
                    this.velY += this.gravity;
                    this.x += this.velX;
                    this.y += this.velY;
                    this.alpha -= this.decay;
                    return this.alpha <= this.decay;
                }
                draw() {
                    ctx.globalAlpha = this.alpha;
                    ctx.fillStyle = `hsl(${this.hue}, 100%, 50%)`;
                    ctx.beginPath();
                    ctx.arc(this.x, this.y, 2, 0, Math.PI * 2);
                    ctx.fill();
                    ctx.globalAlpha = 1;
                }
            }
            
            class Firework {
                constructor(isGrand = false) {
                    this.isGrand = isGrand;
                    this.x = isGrand ? canvas.width / 2 : Math.random() * canvas.width;
                    this.y = canvas.height;
                    this.targetY = isGrand ? canvas.height / 4 : Math.random() * (canvas.height / 2);
                    this.hue = Math.random() * 360;
                    this.velY = -(Math.random() * 4 + (isGrand ? 12 : 8));
                    this.velX = isGrand ? 0 : (Math.random() - 0.5) * 6;
                    this.particleCount = isGrand ? 400 : 120;
                    playLaunchSound();
                }
                update() {
                    this.x += this.velX;
                    this.y += this.velY;
                    this.velY += 0.2;

                    if (this.y <= this.targetY) {
                        this.explode();
                        return true;
                    }
                    return false;
                }
                explode() {
                    createExplosion(this.x, this.y, this.particleCount, this.isGrand);
                }
                draw() {
                    ctx.fillStyle = `hsl(${this.hue}, 100%, 50%)`;
                    ctx.beginPath();
                    ctx.arc(this.x, this.y, this.isGrand ? 4 : 3, 0, Math.PI * 2);
                    ctx.fill();
                }
            }
        });
    </script>
</body>
</html>
